<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
    <head>
        <title>TODO supply a title</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js" integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q" crossorigin="anonymous"></script>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.13.1/font/bootstrap-icons.min.css">
        
            <style>
        :root {
            --primary-color: #4e73df;
            --secondary-color: #6f42c1;
            --success-color: #1cc88a;
            --info-color: #36b9cc;
            --warning-color: #f6c23e;
            --danger-color: #e74a3b;
            --light-bg: #f8f9fc;
            --dark-bg: #2e59d9;
            --text-dark: #5a5c69;
            --text-light: #858796;
            --border-color: #e3e6f0;
        }
        
        body {
            background-color: var(--light-bg);
            color: var(--text-dark);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .container {
            padding: 20px;
            max-width: 100%;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--border-color);
        }
        
        .page-title {
            color: var(--primary-color);
            font-weight: 700;
            margin: 0;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 20px;
        }
        
        .card-header {
            background-color: white;
            border-bottom: 1px solid var(--border-color);
            padding: 15px 20px;
            font-weight: 700;
            color: var(--primary-color);
            border-radius: 10px 10px 0 0 !important;
        }
        
        .card-body {
            padding: 20px;
        }
        
        .search-form {
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
            margin-bottom: 25px;
        }
        
        .form-control, .input-group-text {
            border-radius: 5px;
        }
        
        .input-group-text {
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            border-radius: 5px;
            font-weight: 600;
        }
        
        .btn-primary:hover {
            background-color: var(--dark-bg);
            border-color: var(--dark-bg);
        }
        
        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            color: white;
        }
        
        .btn-danger {
            background-color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .btn-add {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: white;
            font-weight: 600;
            padding: 8px 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .btn-add:hover {
            background-color: #17a673;
            border-color: #17a673;
        }
        
        .table {
            border-collapse: separate;
            border-spacing: 0;
            width: 100%;
            margin-bottom: 1rem;
            color: var(--text-dark);
            background-color: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58, 59, 69, 0.15);
        }
        
        .table thead th {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 15px;
            font-weight: 700;
            text-transform: uppercase;
            font-size: 0.85rem;
            vertical-align: middle;
        }
        
        .table tbody td {
            padding: 12px 15px;
            vertical-align: middle;
            border-top: 1px solid var(--border-color);
        }
        
        .table tbody tr:hover {
            background-color: rgba(78, 115, 223, 0.05);
        }
        
        .table-hover tbody tr:hover {
            background-color: rgba(78, 115, 223, 0.08);
        }
        
        .user-image {
            max-height: 80px;
            max-width: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--border-color);
            display: block;
            margin: 0 auto;
        }
        
        .user-name {
            font-weight: 600;
            color: var(--primary-color);
        }
        
        .user-contact div {
            margin-bottom: 5px;
            font-size: 0.9rem;
        }
        
        .switch-container {
            display: flex;
            justify-content: center;
        }
        
        .form-check-input:checked {
            background-color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .action-buttons {
            display: flex;
            gap: 8px;
        }
        
        .action-buttons .btn {
            padding: 5px 10px;
            font-size: 0.875rem;
        }
        
        .text-muted {
            color: var(--text-light) !important;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .table thead {
                display: none;
            }
            
            .table, .table tbody, .table tr, .table td {
                display: block;
                width: 100%;
            }
            
            .table tr {
                margin-bottom: 15px;
                border-radius: 10px;
                box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            }
            
            .table td {
                text-align: right;
                padding-left: 50%;
                position: relative;
                border-top: none;
                border-bottom: 1px solid var(--border-color);
            }
            
            .table td:last-child {
                border-bottom: none;
            }
            
            .table td::before {
                content: attr(data-label);
                position: absolute;
                left: 15px;
                width: 45%;
                padding-right: 15px;
                text-align: left;
                font-weight: 700;
                color: var(--primary-color);
            }
            
            .action-buttons {
                justify-content: center;
            }
        }
    </style>
    </head>
    <body layout:fragment="body">
        <div class="container">

            <form method="post" th:action="@{/usuario}" th:object="${usuarioBusqueda}">
                <div class="row">

                    <div class="col-12 col-md-3 mb-3">
            <div class="input-group">
                <span class="input-group-text">@</span>
                <input type="text" class="form-control" placeholder="Nombre" th:field="*{Nombre}">
            </div>
        </div>

        <div class="col-12 col-md-3 mb-3">
            <div class="input-group">
                <span class="input-group-text">@</span>
                <input type="text" class="form-control" placeholder="Apellido Paterno" th:field="*{ApellidoPaterno}">
            </div>
        </div>
                    <div class="col-12 col-md-3 mb-3">
            <div class="input-group">
                <span class="input-group-text">@</span>
                <input type="text" class="form-control" placeholder="Apellido Materno" th:field="*{ApellidoMaterno}">
            </div>
        </div>

        <div class="col-12 col-md-2 mb-3">
            <div class="input-group">
                <span class="input-group-text">@</span>
                <input type="number" class="form-control" placeholder="Id Rol" th:field="*{Rol.IdRol}">
            </div>
        </div>
                    
                    <div class="col-12 col-md-1">
                    <button type="submit" class="btn btn-primary input-group mb-3 col-3">Submit</button>
                      </div>
                </div>

            </form>




            <a th:href="@{usuario/action/{idUsuario}(idUsuario=0)}" class="btn btn-primary"><i class="bi bi-plus"></i></a>
            <!--     <a href="/usuario/add" class="btn btn-primary"><i class="bi bi-plus"></i></a> -->

            <table class="table table-hover">
                <thead class="table-dark">
                    <tr>
                        <th class="col-1 text-center"></th>
                        <th class="col-3 text-center">Imagen</th>
                        <th class="col-2 text-center">Nombre</th>
                        <th class="col-2 text-center">Contacto</th>
                        <th class="col-3 text-center">Dirección</th>
                        <th class="col-1 text-center">Status</th>
                    </tr>
                </thead>

                <tbody>
                    <tr th:each="usuario : ${usuarios}">
                        <td><a th:href="@{/usuario/action/{idUsuario}(idUsuario = ${usuario.IdUsuario})}" class="btn btn-warning"><i class="bi bi-pencil-square"></i></a><a class="btn btn-danger" th:href="@{/usuario/delete/{IdUsuario}(IdUsuario = ${usuario.IdUsuario})}"><i class="bi bi-trash3-fill"></i></a></td>
<!--                        <td>
                            <img id="imagenUsuario" style="max-height: 80px; max-width: 80px;" th:src="|${(usuario.Imagen != null) ? 'data:image/*;base64,' + usuario.Imagen : 'https://tlconnect.teamlease.com/Images/Profile/default.jpg'}|"/>
                        </td>-->
                        <td style="text-align: center;">
                            <img id="imagenUsuario" style="max-height: 80px; max-width: 80px;" th:src="|${(usuario.Imagen != null) ? 'data:image/*;base64,' + usuario.Imagen : 'https://tlconnect.teamlease.com/Images/Profile/default.jpg'}|"/>
                        </td>
                        <td>
                            <span th:text="${usuario.Nombre}"></span>
                            <span th:if="${usuario.ApellidoPaterno != null and !usuario.ApellidoPaterno.isEmpty()}" 
                                  th:text="' ' + ${usuario.ApellidoPaterno}"></span>
                            <span th:if="${usuario.ApellidoMaterno != null and !usuario.ApellidoMaterno.isEmpty()}" 
                                  th:text="' ' + ${usuario.ApellidoMaterno}"></span>
                            <span th:if="${(usuario.ApellidoPaterno == null or usuario.ApellidoPaterno.isEmpty()) and 
                                  (usuario.ApellidoMaterno == null or usuario.ApellidoMaterno.isEmpty())}" 
                                  th:text="' (Sin apellidos)'" class="text-muted"></span>
                        </td>
                        <td>
                            <div th:if="${usuario.Telefono != null and !usuario.Telefono.isEmpty()}" 
                                 th:text="'Tel: ' + ${usuario.Telefono}"></div>
                            <div th:if="${usuario.Celular != null and !usuario.Celular.isEmpty()}" 
                                 th:text="'Cel: ' + ${usuario.Celular}"></div>
                            <div th:if="${usuario.Email != null and !usuario.Email.isEmpty()}" 
                                 th:text="'Email: ' + ${usuario.Email}"></div>
                            <div th:if="${usuario.CURP != null and !usuario.CURP.isEmpty()}" 
                                 th:text="'CURP: ' + ${usuario.CURP}"></div>
                            <div th:if="${(usuario.Telefono == null or usuario.Telefono.isEmpty()) and 
                                 (usuario.Celular == null or usuario.Celular.isEmpty()) and 
                                 (usuario.Email == null or usuario.Email.isEmpty()) and 
                                 (usuario.CURP == null or usuario.CURP.isEmpty())}" 
                                 class="text-muted">Sin contacto</div>
                        </td>
                        <td>
<!--                div con una condicional if que evalue que si IdUsuario es > 0 y IdDireccion == null se esconda esta parte-->
                <div th:each="direccion : ${usuario.Direcciones}" th:text="|${direccion.Calle} ${direccion.NumeroExterior} ${direccion.NumeroInterior}
                     ${direccion.Colonia.Nombre}, ${direccion.Colonia.CodigoPostal} ${direccion.Colonia.Municipio.Nombre} ${direccion.Colonia.Municipio.Estado.Nombre}
                     ${direccion.Colonia.Municipio.Estado.Pais.Nombre}|"></div>
                        </td>
                        <td>
                            <div class="form-check form-switch">
                                <input class="form-check-input switch-baja-logica" 
                                       type="checkbox" 
                                       role="switch" 
                                       th:attr="data-id=${usuario.IdUsuario}"
                                       th:checked="${usuario.Status}">
                            </div>
                        </td>

            
                    </tr>
                </tbody>
            </table>
        </div>
        
        <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
        <script>
$(document).ready(function() {
   
    function bajaLogica(element) {
        if (!element) return; 

        let idUsuario = $(element).data("id");
        if (idUsuario === undefined) return; 

        console.log("idUsuario:", idUsuario);

        let datos = {
            idUsuario: idUsuario,
            activo: false
        };

        element.disabled = true;

        $.ajax({
            url: "http://localhost:8080/usuarioapi/status/" + idUsuario,
            type: "PUT",
            contentType: "application/json",
            data: JSON.stringify(datos),
            success: function(result) {
                if (!result.correct) {
                
                    element.checked = !element.checked;
                }
                element.disabled = false;
            },
            error: function(message) {
                console.error("Error en la baja lógica:", message);
                element.checked = !element.checked;
                element.disabled = false;
            }
        });
    }

    $(document).on('change', '.switch-baja-logica', function() {
        if (this) {
            bajaLogica(this);
        }
    });
});
        </script>
    </body>
</html>
